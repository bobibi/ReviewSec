<?php 
namespace ReviewSec\Math;

class Gaussian {
    static protected $CDF_CUTOFF = 3.2;
    static protected $CDF_DX = 0.032161;
    static protected $CDF_TABLE = array(
        0.000687,
        0.000768,
        0.000857,
        0.000956,
        0.001065,
        0.001186,
        0.001319,
        0.001466,
        0.001627,
        0.001804,
        0.001999,
        0.002212,
        0.002446,
        0.002702,
        0.002982,
        0.003288,
        0.003622,
        0.003986,
        0.004382,
        0.004814,
        0.005282,
        0.005791,
        0.006343,
        0.006941,
        0.007588,
        0.008288,
        0.009044,
        0.009859,
        0.010738,
        0.011685,
        0.012703,
        0.013797,
        0.014971,
        0.016230,
        0.017579,
        0.019022,
        0.020565,
        0.022213,
        0.023971,
        0.025844,
        0.027838,
        0.029958,
        0.032211,
        0.034602,
        0.037137,
        0.039821,
        0.042661,
        0.045663,
        0.048832,
        0.052175,
        0.055697,
        0.059404,
        0.063301,
        0.067395,
        0.071690,
        0.076193,
        0.080907,
        0.085839,
        0.090992,
        0.096371,
        0.101980,
        0.107823,
        0.113903,
        0.120224,
        0.126788,
        0.133597,
        0.140654,
        0.147959,
        0.155514,
        0.163320,
        0.171375,
        0.179681,
        0.188234,
        0.197035,
        0.206079,
        0.215366,
        0.224891,
        0.234650,
        0.244639,
        0.254853,
        0.265285,
        0.275930,
        0.286781,
        0.297830,
        0.309068,
        0.320489,
        0.332082,
        0.343838,
        0.355747,
        0.367799,
        0.379982,
        0.392286,
        0.404698,
        0.417206,
        0.429800,
        0.442465,
        0.455189,
        0.467959,
        0.480762,
        0.493585,
        0.506415,
        0.519238,
        0.532041,
        0.544811,
        0.557535,
        0.570200,
        0.582794,
        0.595302,
        0.607714,
        0.620018,
        0.632201,
        0.644253,
        0.656162,
        0.667918,
        0.679511,
        0.690932,
        0.702170,
        0.713219,
        0.724070,
        0.734715,
        0.745147,
        0.755361,
        0.765350,
        0.775109,
        0.784634,
        0.793921,
        0.802965,
        0.811766,
        0.820319,
        0.828625,
        0.836680,
        0.844486,
        0.852041,
        0.859346,
        0.866403,
        0.873212,
        0.879776,
        0.886097,
        0.892177,
        0.898020,
        0.903629,
        0.909008,
        0.914161,
        0.919093,
        0.923807,
        0.928310,
        0.932605,
        0.936699,
        0.940596,
        0.944303,
        0.947825,
        0.951168,
        0.954337,
        0.957339,
        0.960179,
        0.962863,
        0.965398,
        0.967789,
        0.970042,
        0.972162,
        0.974156,
        0.976029,
        0.977787,
        0.979435,
        0.980978,
        0.982421,
        0.983770,
        0.985029,
        0.986203,
        0.987297,
        0.988315,
        0.989262,
        0.990141,
        0.990956,
        0.991712,
        0.992412,
        0.993059,
        0.993657,
        0.994209,
        0.994718,
        0.995186,
        0.995618,
        0.996014,
        0.996378,
        0.996712,
        0.997018,
        0.997298,
        0.997554,
        0.997788,
        0.998001,
        0.998196,
        0.998373,
        0.998534,
        0.998681,
        0.998814,
        0.998935,
        0.999044,
        0.999143,
        0.999232,
        0.999313,
    );
    
    static protected $INVCDF_CUTOFF = 0.001;
    static protected $INVCDF_DP = 0.005015;
    static protected $INVCDF_TABLE = array(
        -3.090232,
        -2.511259,
        -2.289328,
        -2.143282,
        -2.032327,
        -1.941887,
        -1.865004,
        -1.797785,
        -1.737828,
        -1.683536,
        -1.633797,
        -1.587800,
        -1.544936,
        -1.504736,
        -1.466831,
        -1.430923,
        -1.396771,
        -1.364175,
        -1.332967,
        -1.303006,
        -1.274170,
        -1.246358,
        -1.219477,
        -1.193449,
        -1.168206,
        -1.143686,
        -1.119835,
        -1.096605,
        -1.073952,
        -1.051837,
        -1.030225,
        -1.009083,
        -0.988384,
        -0.968099,
        -0.948205,
        -0.928679,
        -0.909502,
        -0.890653,
        -0.872115,
        -0.853872,
        -0.835909,
        -0.818212,
        -0.800767,
        -0.783563,
        -0.766588,
        -0.749831,
        -0.733281,
        -0.716930,
        -0.700769,
        -0.684789,
        -0.668981,
        -0.653339,
        -0.637855,
        -0.622523,
        -0.607336,
        -0.592287,
        -0.577372,
        -0.562583,
        -0.547917,
        -0.533368,
        -0.518931,
        -0.504601,
        -0.490374,
        -0.476245,
        -0.462212,
        -0.448268,
        -0.434411,
        -0.420637,
        -0.406942,
        -0.393324,
        -0.379778,
        -0.366301,
        -0.352890,
        -0.339543,
        -0.326255,
        -0.313025,
        -0.299850,
        -0.286727,
        -0.273652,
        -0.260625,
        -0.247641,
        -0.234699,
        -0.221796,
        -0.208930,
        -0.196099,
        -0.183300,
        -0.170530,
        -0.157789,
        -0.145073,
        -0.132380,
        -0.119709,
        -0.107057,
        -0.094422,
        -0.081802,
        -0.069195,
        -0.056599,
        -0.044012,
        -0.031432,
        -0.018858,
        -0.006286,
        0.006286,
        0.018858,
        0.031432,
        0.044012,
        0.056599,
        0.069195,
        0.081802,
        0.094422,
        0.107057,
        0.119709,
        0.132380,
        0.145073,
        0.157789,
        0.170530,
        0.183300,
        0.196099,
        0.208930,
        0.221796,
        0.234699,
        0.247641,
        0.260625,
        0.273652,
        0.286727,
        0.299850,
        0.313025,
        0.326255,
        0.339543,
        0.352890,
        0.366301,
        0.379778,
        0.393324,
        0.406942,
        0.420637,
        0.434411,
        0.448268,
        0.462212,
        0.476245,
        0.490374,
        0.504601,
        0.518931,
        0.533368,
        0.547917,
        0.562583,
        0.577372,
        0.592287,
        0.607336,
        0.622523,
        0.637855,
        0.653339,
        0.668981,
        0.684789,
        0.700769,
        0.716930,
        0.733281,
        0.749831,
        0.766588,
        0.783563,
        0.800767,
        0.818212,
        0.835909,
        0.853872,
        0.872115,
        0.890653,
        0.909502,
        0.928679,
        0.948205,
        0.968099,
        0.988384,
        1.009083,
        1.030225,
        1.051837,
        1.073952,
        1.096605,
        1.119835,
        1.143686,
        1.168206,
        1.193449,
        1.219477,
        1.246358,
        1.274170,
        1.303006,
        1.332967,
        1.364175,
        1.396771,
        1.430923,
        1.466831,
        1.504736,
        1.544936,
        1.587800,
        1.633797,
        1.683536,
        1.737828,
        1.797785,
        1.865004,
        1.941887,
        2.032327,
        2.143282,
        2.289328,
        2.511259,
        3.090232,
    );
    
    function cdf($x, $mu, $sigma) {
        return $this->stdcdf(($x-$mu)/$sigma);
    }
    
    function stdcdf($x) {
        if ($x < -static::$CDF_CUTOFF) {
            return 0;
        }
        if ($x > static::$CDF_CUTOFF) {
            return 1;
        }
        $i = round(($x+static::$CDF_CUTOFF)/static::$CDF_DX);
        return static::$CDF_TABLE[$i];
    }
    
    function invcdf($p, $mu, $sigma) {
        return $this->stdinvcdf($p)*$sigma+$mu;
    }
    
    function stdinvcdf($p) {
        if ($p<static::$INVCDF_CUTOFF) {
            return -3.2;
        }        
        if ($p>1-static::$INVCDF_CUTOFF) {
            return 3.2;
        }        
        $i = round(($p-static::$INVCDF_CUTOFF)/static::$INVCDF_DP);
        return static::$INVCDF_TABLE[$i];
    }
}